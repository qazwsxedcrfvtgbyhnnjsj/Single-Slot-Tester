<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHIR Single Slot Tester</title>
    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); max-width: 800px; margin: 40px auto; padding: 20px; }
        .card { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5rem; margin-bottom: 1rem; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; }
        .upload-area { border: 2px dashed #cbd5e1; padding: 2rem; border-radius: 0.5rem; text-align: center; margin: 1.5rem 0; transition: 0.3s; }
        .upload-area:hover { border-color: var(--primary); background: #f5f3ff; }
        input[type="file"] { margin-bottom: 1rem; }
        .btn { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600; width: 100%; }
        .btn:hover { opacity: 0.9; }
        #result-container { margin-top: 2rem; display: none; }
        pre { background: #0f172a; color: #f8fafc; padding: 1.5rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.875rem; line-height: 1.5; }
        .status-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem; font-weight: 500; margin-bottom: 1rem; }
        .success { background: #dcfce7; color: #166534; }
        .error { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

    <div class="card">
        <h1>âš¡ FHIR å–®ç­†è½‰æ›æ¸¬è©¦å™¨</h1>
        <p>ä¸Šå‚³ CSV æª”æ¡ˆï¼Œç³»çµ±å°‡è®€å–<strong>ç¬¬ä¸€ç­†</strong>æ•¸æ“šä¸¦è½‰æ›ç‚º FHIR Slot Resourceã€‚</p>

        <div class="upload-area">
            <input type="file" id="csvFile" accept=".csv">
            <button class="btn" onclick="uploadSingle()">é–‹å§‹å–®ç­†è½‰æ›</button>
        </div>

        <div id="result-container">
            <div id="statusLabel" class="status-badge"></div>
            <pre id="jsonOutput"></pre>
        </div>
    </div>

    <script>
        async function uploadSingle() {
            const fileInput = document.getElementById('csvFile');
            const resultContainer = document.getElementById('result-container');
            const jsonOutput = document.getElementById('jsonOutput');
            const statusLabel = document.getElementById('statusLabel');

            if (!fileInput.files[0]) {
                alert("è«‹å…ˆé¸æ“‡ CSV æª”æ¡ˆ");
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            // é¡¯ç¤ºè¼‰å…¥ä¸­
            resultContainer.style.display = 'block';
            statusLabel.className = 'status-badge';
            statusLabel.innerText = "â³ è™•ç†ä¸­...";
            jsonOutput.innerText = "æ­£åœ¨è§£æè³‡æ–™...";

            try {
                // æ³¨æ„ï¼šé€™è£¡å‘¼å«çš„æ˜¯ä½ æ–°å°ˆæ¡ˆå®šç¾©çš„ Route
               const response = await fetch('/api/ScheduleUpload/convert-single', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.text();

                if (response.ok) {
                    const jsonObj = JSON.parse(data);
                    statusLabel.className = 'status-badge success';
                    statusLabel.innerText = "âœ… è½‰æ›æˆåŠŸ (å–®ç­†)";
                    jsonOutput.innerText = JSON.stringify(jsonObj, null, 4);
                } else {
                    statusLabel.className = 'status-badge error';
                    statusLabel.innerText = "âŒ è½‰æ›å¤±æ•—";
                    jsonOutput.innerText = data;
                }
            } catch (err) {
                statusLabel.className = 'status-badge error';
                statusLabel.innerText = "ğŸ“¡ é€£ç·šéŒ¯èª¤";
                jsonOutput.innerText = "ç„¡æ³•é€£æ¥åˆ° APIï¼Œè«‹ç¢ºèªå¾Œç«¯æ˜¯å¦å·²å•Ÿå‹• (dotnet run)ã€‚";
            }
        }
    </script>
</body>
</html>